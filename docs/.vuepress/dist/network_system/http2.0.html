<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.32">
    <title>● HTTP 2.0 | NoJsJa Frontend Summary</title><meta name="description" content="网络协议">
    <link rel="modulepreload" href="/frontend-summary/assets/app.61a6108e.js"><link rel="modulepreload" href="/frontend-summary/assets/http2.0.html.2e79103d.js"><link rel="modulepreload" href="/frontend-summary/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/frontend-summary/assets/http2.0.html.59aab02e.js">
    <link rel="stylesheet" href="/frontend-summary/assets/style.c7eaaf18.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/frontend-summary/" class=""><img class="logo" src="https://nojsja.gitee.io/blogs/img/avatar/nojsja.jpeg" alt="NoJsJa Frontend Summary"><span class="site-name can-hide">NoJsJa Frontend Summary</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://nojsja.gitee.io/blogs" rel="noopener noreferrer" target="_blank" aria-label="Blogs"><!--[--><!--]--> Blogs <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/nojsja" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://nojsja.gitee.io/blogs" rel="noopener noreferrer" target="_blank" aria-label="Blogs"><!--[--><!--]--> Blogs <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/nojsja" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/frontend-summary/" class="sidebar-item sidebar-heading" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/html_css" class="sidebar-item sidebar-heading" aria-label="➣ HTML/CSS 部分"><!--[--><!--]--> ➣ HTML/CSS 部分 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend-summary/html_css/base.html" class="sidebar-item" aria-label="● 基础知识"><!--[--><!--]--> ● 基础知识 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/html_css/keys.html" class="sidebar-item" aria-label="● 考点梳理"><!--[--><!--]--> ● 考点梳理 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/frontend-summary/js" class="sidebar-item sidebar-heading" aria-label="➣ Javascript 部分"><!--[--><!--]--> ➣ Javascript 部分 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend-summary/js/base.html" class="sidebar-item" aria-label="● 基础知识"><!--[--><!--]--> ● 基础知识 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/js/keys.html" class="sidebar-item" aria-label="● 考点梳理"><!--[--><!--]--> ● 考点梳理 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/frontend-summary/react" class="sidebar-item sidebar-heading" aria-label="➣ React 部分"><!--[--><!--]--> ➣ React 部分 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend-summary/react/base.html" class="sidebar-item" aria-label="● 基础知识"><!--[--><!--]--> ● 基础知识 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/react/keys.html" class="sidebar-item" aria-label="● 考点梳理"><!--[--><!--]--> ● 考点梳理 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/frontend-summary/node" class="sidebar-item sidebar-heading" aria-label="➣ Node 部分"><!--[--><!--]--> ➣ Node 部分 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend-summary/node/base.html" class="sidebar-item" aria-label="● 基础知识"><!--[--><!--]--> ● 基础知识 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/node/keys.html" class="sidebar-item" aria-label="● 考点梳理"><!--[--><!--]--> ● 考点梳理 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/frontend-summary/optimization" class="sidebar-item sidebar-heading" aria-label="➣ 前端性能优化"><!--[--><!--]--> ➣ 前端性能优化 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend-summary/optimization/code.html" class="sidebar-item" aria-label="● 编码优化"><!--[--><!--]--> ● 编码优化 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/optimization/http.html" class="sidebar-item" aria-label="● http 优化"><!--[--><!--]--> ● http 优化 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/optimization/build.html" class="sidebar-item" aria-label="● 构建优化"><!--[--><!--]--> ● 构建优化 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/frontend-summary/structure" class="sidebar-item sidebar-heading" aria-label="➣ 前端工程化和架构"><!--[--><!--]--> ➣ 前端工程化和架构 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend-summary/structure/base.html" class="sidebar-item" aria-label="● 基础知识"><!--[--><!--]--> ● 基础知识 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/structure/keys.html" class="sidebar-item" aria-label="● 考点梳理"><!--[--><!--]--> ● 考点梳理 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/structure/project.html" class="sidebar-item" aria-label="● 项目架构梳理"><!--[--><!--]--> ● 项目架构梳理 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/frontend-summary/network_system" class="router-link-active sidebar-item sidebar-heading active" aria-label="➣ 操作系统和网络"><!--[--><!--]--> ➣ 操作系统和网络 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend-summary/network_system/base.html" class="sidebar-item" aria-label="● 基础知识"><!--[--><!--]--> ● 基础知识 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/network_system/keys.html" class="sidebar-item" aria-label="● 考点梳理"><!--[--><!--]--> ● 考点梳理 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/network_system/http.html" class="sidebar-item" aria-label="● HTTP 协议"><!--[--><!--]--> ● HTTP 协议 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/network_system/https.html" class="sidebar-item" aria-label="● HTTPS 协议"><!--[--><!--]--> ● HTTPS 协议 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend-summary/network_system/http2.0.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="● HTTP 2.0"><!--[--><!--]--> ● HTTP 2.0 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/frontend-summary/network_system/http2.0.html#➣-http-发展史" class="router-link-active router-link-exact-active sidebar-item" aria-label="➣ HTTP 发展史"><!--[--><!--]--> ➣ HTTP 发展史 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend-summary/network_system/http2.0.html#➣-目前存在的问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="➣ 目前存在的问题"><!--[--><!--]--> ➣ 目前存在的问题 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend-summary/network_system/http2.0.html#➣-http-2-0-的时代来了" class="router-link-active router-link-exact-active sidebar-item" aria-label="➣ HTTP/2.0 的时代来了"><!--[--><!--]--> ➣ HTTP/2.0 的时代来了 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/frontend-summary/network_system/http2.0.html#二进制分帧层" class="router-link-active router-link-exact-active sidebar-item" aria-label="二进制分帧层"><!--[--><!--]--> 二进制分帧层 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend-summary/network_system/http2.0.html#多路复用" class="router-link-active router-link-exact-active sidebar-item" aria-label="多路复用"><!--[--><!--]--> 多路复用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend-summary/network_system/http2.0.html#头部压缩" class="router-link-active router-link-exact-active sidebar-item" aria-label="头部压缩"><!--[--><!--]--> 头部压缩 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend-summary/network_system/http2.0.html#服务器端推送" class="router-link-active router-link-exact-active sidebar-item" aria-label="服务器端推送"><!--[--><!--]--> 服务器端推送 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/frontend-summary/network_system/http2.0.html#➣-参考文章" class="router-link-active router-link-exact-active sidebar-item" aria-label="➣ 参考文章"><!--[--><!--]--> ➣ 参考文章 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><li><a href="/frontend-summary/design_pattern" class="sidebar-item sidebar-heading" aria-label="➣ 设计模式"><!--[--><!--]--> ➣ 设计模式 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend-summary/design_pattern/decorator.html" class="sidebar-item" aria-label="● 装饰器模式"><!--[--><!--]--> ● 装饰器模式 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/design_pattern/flyweight.html" class="sidebar-item" aria-label="● 享元模式"><!--[--><!--]--> ● 享元模式 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/design_pattern/observer.html" class="sidebar-item" aria-label="● 观察者模式"><!--[--><!--]--> ● 观察者模式 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/design_pattern/proxy.html" class="sidebar-item" aria-label="● 代理模式"><!--[--><!--]--> ● 代理模式 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/design_pattern/responsibility_chain.html" class="sidebar-item" aria-label="● 责任链模式"><!--[--><!--]--> ● 责任链模式 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/design_pattern/state.html" class="sidebar-item" aria-label="● 状态模式"><!--[--><!--]--> ● 状态模式 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/design_pattern/strategy.html" class="sidebar-item" aria-label="● 策略模式"><!--[--><!--]--> ● 策略模式 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/design_pattern/template.html" class="sidebar-item" aria-label="● 模板方法模式"><!--[--><!--]--> ● 模板方法模式 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/frontend-summary/data" class="sidebar-item sidebar-heading" aria-label="➣ 数据结构"><!--[--><!--]--> ➣ 数据结构 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend-summary/data/keys.html" class="sidebar-item" aria-label="● 考点梳理"><!--[--><!--]--> ● 考点梳理 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/data/base.html" class="sidebar-item" aria-label="● 基础知识"><!--[--><!--]--> ● 基础知识 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/frontend-summary/algorithms" class="sidebar-item sidebar-heading" aria-label="➣ 算法"><!--[--><!--]--> ➣ 算法 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend-summary/algorithms/array.html" class="sidebar-item" aria-label="● 数组"><!--[--><!--]--> ● 数组 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/algorithms/dp.html" class="sidebar-item" aria-label="● 动态规划"><!--[--><!--]--> ● 动态规划 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/algorithms/linked_list.html" class="sidebar-item" aria-label="● 链表"><!--[--><!--]--> ● 链表 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/algorithms/string.html" class="sidebar-item" aria-label="● 字符串处理"><!--[--><!--]--> ● 字符串处理 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/algorithms/sort.html" class="sidebar-item" aria-label="● 排序算法"><!--[--><!--]--> ● 排序算法 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/algorithms/tree.html" class="sidebar-item" aria-label="● 树"><!--[--><!--]--> ● 树 <!--[--><!--]--></a><!----></li><li><a href="/frontend-summary/algorithms/others.html" class="sidebar-item" aria-label="● 其它"><!--[--><!--]--> ● 其它 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="➣-http-发展史" tabindex="-1"><a class="header-anchor" href="#➣-http-发展史" aria-hidden="true">#</a> ➣ HTTP 发展史</h2><p>正式讲 HTTP2 之前我们先讲一下 HTTP 的发展史。</p><p><img src="https://nojsja.gitee.io/static-resources/images/http/http-http2.0.png" alt=""></p><ul><li>HTTP/0.9 - 单行协议 HTTP 于 1990 年问世，那时候 HTTP 非常简单：只支持 GET 方法；没有首部；只能获取纯文本。</li><li>HTTP/1.0 - 搭建协议的框架 1996 年，HTTP 正式被作为标准公布，版本为 HTTP/1.0。1.0 版本增加了首部、状态码、权限、缓存、长连接（默认短连接）等规范，可以说搭建了协议的基本框架。</li><li>HTTP/1.1 - 进一步完善 1997 年，1.1 版本接踵而至。1.1 版本的重大改进在于默认长连接；强制客户端提供 Host 首部；管线化；Cache-Control、ETag 等缓存的相关扩展。</li></ul><h2 id="➣-目前存在的问题" tabindex="-1"><a class="header-anchor" href="#➣-目前存在的问题" aria-hidden="true">#</a> ➣ 目前存在的问题</h2><p>现在我们先不聊 HTTP2, 看一下 HTTP 发展到 1.1 存在有哪些问题：</p><ol><li>线头阻塞：TCP 连接上只能发送一个请求，前面的请求未完成前，后续的请求都在排队等待。</li><li>多个 TCP 连接 虽然 HTTP/1.1 管线化可以支持请求并发，但是浏览器很难实现，chrome、firefox 等都禁用了管线化。所以 1.1 版本请求并发依赖于多个 TCP 连接，建立 TCP 连接成本很高，还会存在慢启动的问题。</li><li>头部冗余，采用文本格式 HTTP/1.X 版本是采用文本格式，首部未压缩，而且每一个请求都会带上 cookie、user-agent 等完全相同的首部。</li><li>客户端需要主动请求</li></ol><h2 id="➣-http-2-0-的时代来了" tabindex="-1"><a class="header-anchor" href="#➣-http-2-0-的时代来了" aria-hidden="true">#</a> ➣ HTTP/2.0 的时代来了</h2><p>先来一个 demo 感受一下吊炸天的 HTTP/2.0，这个 demo 是加载 379 张图片，来对比 HTTP/1.1 和 HTTP/2.0 的性能。 <a href="https://http2.akamai.com/demo" target="_blank" rel="noopener noreferrer">HTTP/1.1 与 2.0 性能比较<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p>理论上 HTTP/2.0 会比 HTTP/1.1 有一倍多的性能提升，弱网环境下，性能提升会更加明显。 接下来我们正式开始聊聊 2.0。看看 2.0 相比与 1.1 的一些重大改进。</p><h3 id="二进制分帧层" tabindex="-1"><a class="header-anchor" href="#二进制分帧层" aria-hidden="true">#</a> 二进制分帧层</h3><p>HTTP2 性能提升的核心就在于二进制分帧层。HTTP2 是二进制协议，他采用二进制格式传输数据而不是 1.x 的文本格式。</p><p><img src="https://nojsja.gitee.io/static-resources/images/http/http2.0.png" alt=""></p><p>看图吧！很清晰的表达了 HTTP/1.1 的响应和 2.0 的区别。1.1 响应是文本格式，而 2.0 把响应划分成了两个帧，图中的 HEADERS（首部）和 DATA（消息负载） 是帧的类型。<a href="https://www.ibm.com/developerworks/cn/web/wa-http2-under-the-hood/index.html" target="_blank" rel="noopener noreferrer">了解更多帧的类型<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 也就是说一条 HTTP 响应，划分成了两个帧来传输，并且采用二进制来编码。</p><p>这里我们来提三个概念。</p><ul><li>流（Stream）：已建立的 TCP 连接上的双向字节流，可以承载一个或多个消息。</li><li>消息（Message）：一个完整的 HTTP 请求或响应，由一个或多个帧组成。特定消息的帧在同一个流上发送，这意味着一个 HTTP 请求或响应只能在一个流上发送。</li><li>帧（Frame）：通信的基本单位。 一个 TCP 连接上可以有任意数量的流。</li></ul><h3 id="多路复用" tabindex="-1"><a class="header-anchor" href="#多路复用" aria-hidden="true">#</a> 多路复用</h3><p>上面提到 HTTP/1.1 的线头阻塞和多个 TCP 连接的问题，HTTP2 的多路复用完美解决。HTTP2 让所有的通信都在一个 TCP 连接上完成，真正实现了请求的并发。我们来看一下 HTTP2 具体是怎么实现的：</p><p><img src="https://nojsja.gitee.io/static-resources/images/http/http2.0-stream.png" alt=""></p><p>HTTP2 建立一个 TCP 连接，一个连接上面可以有任意多个流（stream），消息分割成一个或多个帧在流里面传输。帧传输过去以后，再进行重组，形成一个完整的请求或响应。这使得所有的请求或响应都无法阻塞。 我们再来回看上面的那个 demo:</p><p>需要注意的是：虽然一个 TCP 连接可以有任意数量的流，也就是同时可以并发任意数量的请求，但是浏览器还是会有请求发送排队的情况。原因就是请求太多时，浏览器或服务器会受不了，这超出了它的处理能力。流控制帮我们解决了这个问题，流控制会管理数据的传输，允许接收者停止或减少发送的数据量，免得接收方不堪重负。所以请求太多时，还是会存在排队等待的问题，因为不管是客户端或服务器端，能同时处理请求或响应都是有限的。</p><h3 id="头部压缩" tabindex="-1"><a class="header-anchor" href="#头部压缩" aria-hidden="true">#</a> 头部压缩</h3><p>头部压缩也是 HTTP2 的一大亮点。在 1.X 版本中，首部用文本格式传输，通常会给每个传输增加 500-800 字节的开销。现在打开一个网页上百个请求已是常态，而每个请求带的一些首部字段都是相同的，例如 cookie、user-agent 等。HTTP2 为此采用 HPACK 压缩格式来压缩首部。头部压缩需要在浏览器和服务器端之间：</p><ul><li>维护一份相同的静态字典，包含常见的头部名称，以及常见的头部名称和值的组合</li><li>维护一份相同的动态字典，可以动态的添加内容</li><li>通过静态 Huffman 编码对传输的首部字段进行编码</li></ul><p>HTTP2 的静态字典是长这个样子的（只截取了部分，<a href="https://httpwg.org/specs/rfc7541.html#static.table.definition" target="_blank" rel="noopener noreferrer">完整表格在这里<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>）：</p><p><img src="https://nojsja.gitee.io/static-resources/images/http/http2.0-headers.png" alt=""></p><p>所以我们在传输首部字段的时候，例如要传输 method:GET, 那我们只需要传输静态字典里面 method:GET 对应的索引值就可以了，一个字节搞定。像 user-agent、cookie 这种静态字典里面只有首部名称而没有值的首部，第一次传输需要 user-agent 在静态字典中的索引以及他的值，值会采用静态 Huffman 编码来减小体积。</p><p>第一次传输过 user-agent 之后呢，浏览器和服务器端就会把它添加到自己的动态字典中。后续传输就可以传输索引了，一个字节搞定。</p><h3 id="服务器端推送" tabindex="-1"><a class="header-anchor" href="#服务器端推送" aria-hidden="true">#</a> 服务器端推送</h3><p>服务器端推送使得服务器可以预测客户端需要的资源，主动推送到客户端。 例如：客户端请求 index.html，服务器端能够额外推送 script.js 和 style.css。 实现原理就是客户端发出页面请求时，服务器端能够分析这个页面所依赖的其他资源，主动推送到客户端的缓存，当客户端收到原始网页的请求时，它需要的资源已经位于缓存。</p><p>针对每一个希望发送的资源，服务器会发送一个 PUSH_PROMISE 帧，客户端可以通过发送 RST_STREAM 帧来拒绝推送（当资源已经位于缓存）。这一步的操作先于父响应（index.html），客户端了解到服务器端打算推送哪些资源，就不会再为这些资源创建重复请求。当客户端收到 index.html 的响应时，script.js 和 style.css 已经位于缓存。</p><h2 id="➣-参考文章" tabindex="-1"><a class="header-anchor" href="#➣-参考文章" aria-hidden="true">#</a> ➣ 参考文章</h2><ul><li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fweb%2Ffundamentals%2Fperformance%2Fhttp2%2F%3Fhl%3Dzh-cn%23_8" title="https://developers.google.com/web/fundamentals/performance/http2/?hl=zh-cn#_8" target="_blank" rel="noopener noreferrer">HTTP/2 简介<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fweb%2Fwa-http2-under-the-hood%2Findex.html" title="https://www.ibm.com/developerworks/cn/web/wa-http2-under-the-hood/index.html" target="_blank" rel="noopener noreferrer">HTTP/2 幕后原理<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://link.juejin.cn?target=https%3A%2F%2Fimququ.com%2Fpost%2Fheader-compression-in-http2.html" title="https://imququ.com/post/header-compression-in-http2.html" target="_blank" rel="noopener noreferrer">HTTP/2 头部压缩技术介绍<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://link.juejin.cn?target=https%3A%2F%2Fimququ.com%2Fpost%2Fhttp2-traffic-in-wireshark.html" title="https://imququ.com/post/http2-traffic-in-wireshark.html" target="_blank" rel="noopener noreferrer">使用 Wireshark 调试 HTTP/2 流量<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F34074946%2Fanswer%2F75364178" title="https://www.zhihu.com/question/34074946/answer/75364178" target="_blank" rel="noopener noreferrer">HTTP/2.0 相比 1.0 有哪些重大改进？<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://link.juejin.cn?target=http%3A%2F%2Fio.upyun.com%2F2015%2F05%2F13%2Fhttp2%2F" title="http://io.upyun.com/2015/05/13/http2/" target="_blank" rel="noopener noreferrer">HTTP/2 新特性浅析<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li></ul><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: yangwei13@outlook.com">nojsja</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/frontend-summary/network_system/https.html" class="" aria-label="● HTTPS 协议"><!--[--><!--]--> ● HTTPS 协议 <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/frontend-summary/assets/app.61a6108e.js" defer></script>
  </body>
</html>
