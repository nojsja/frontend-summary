---
lang: zh-CN
title: ● 项目架构梳理
description: project 的描述
---

## ➣ 前公司 dview 项目的整体构成 (dt)

dview 是一个聚合服务云平台，内部包含很多子服务：

#### 1. 数据存储相关服务

- 对象存储服务：基于 ceph s3 的对象存储服务，支持桶管理和桶内数据管理。
- 文件系统服务：文件系统的创建、挂载、卸载。
- 卷管理服务：也就是硬盘或者分区的管理，支持卷的快照、克隆、拷贝、删除等。
- 数据湖：基于对象存储，相比于对象存储，提升了架构扩展性：以集群服务节点为基本单位，可添加和移除多个集群的服务节点，每个节点内的对象存储桶作为基础存储单元，并辅以数据搜索引擎支持。提供桶内对象版本管理、桶对象查看、桶详情设置、桶对象元数据扩展这些功能。
- 存储池：基于卷存储，一个存储池以集群服务节点为基本单位，各个节点的卷作为基本存储单元，支持存储池扩容和所容和多种数据校验策略，各节点间会进行数据自动同步。

#### 2. 用户相关服务

基于 keycloak 的用户认证和管理服务，有多租户的概念。

#### 3. 网络设置相关服务

网络部分分为：内网、数据同步网、外部网络。内网就是内部接口些用的网，web 访问也是这个；数据同步就是我们的集群节点之间互相同步数据用的；外部网络，就是业务网，上面说的高可用 IP 就是这个网，NAS 对象存储 SAN 都可以配置。

- 节点管理服务：节点 ip、网卡设置。
- 高可用服务：保证集群节点在宕机后仍然能提供正常的服务，集群会进行 ip 漂移。

#### 4. 监控相关服务

- 节点管理服务：查看节点资源占用和基本设置等。
- 运维服务：支持节点重启、关机、服务状态、服务重启等。
- 日志服务：分为操作日志、审计日志、运行日志等。

## ➣ 前公司 dview 项目的前端部分架构 (dt)

重构之前

前端外层 nginx 负责客户端的访问控制，同时 nginx 作为 node 访问后端服务时的 router。

#### 前端

web static -> nginx -> node proxy -> cluster nodes

#### 后端

云平台微服务

## ➣ 前公司 dview 项目采用 node.js 作为底层架构的理论依据 (dt)

nodejs 作为前端的静态资源的托管和网关、规范 API，还有就是前端在对象存储和数据湖也是充当了网关的功能，前端访问 nodejs 再访问对象存储。

mock 数据、请求日志、跨域通过 ip 直接调用。

## ➣ 前公司 cicd 系统的架构和原理 (hz)

1. 底层基于 k8s 容器化，生产环境的应用可以在线缩容扩容服务节点，版本发布时可以做到无下线热替换。
2. 有一个 k8s 服务创建界面，可以创建 `Java / Nodejs / Nodejs_static / Python / Static_web` 服务，之后这里创建的服务需要绑定到构建流水线。
3. 每个项目可以创建自己的流水线并绑定之前创建的 k8s 微服务，流水线分为 `dev / test / preview / prod` 流水线。每次流水线构建完成之后会将打包结果生成为一个镜像，与应用绑定的 k8s 容器会引用这个最新的构建镜像。
4. 有一个 nginx 配置系统，外层多个 nginx 服务指向不同的环境：`dev / test / preview / prod`，各个环境配置可以进行同步，并且每个环境下的可以配置很多子域名指向各个 k8s 应用。示例说明：一个不依赖于 Node 的 Static_web 前端项目 ，需要在某个环境下的 nginx 主域名下指定一个`子域名`与其绑定，具体操作就是将这个子域名 nginx 配置里面的 root 路径 `location /` 指向一个 nginx `upstream` 上游配置，这个上游配置即 k8s 内部 `Static_web` 服务对应集群容器内部IP。另外可以配置 `子域名/api` 指向后端另一个 service 网关之类的微服务用于接口调用。
5. 单个 k8s 实例容器内部可以自定义 nginx 的 `static file` 路径和其它配置等。